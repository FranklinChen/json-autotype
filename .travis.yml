sudo: false

# Caching so the next build will be fast too.
cache:
  directories:
  - $HOME/.stack

before_install:
# Download and unpack the stack executable
- mkdir -p ~/.local/bin
- export PATH=$HOME/.local/bin:$PATH
- travis_retry curl -L https://www.stackage.org/stack/linux-x86_64 | tar xz --wildcards --strip-components=1 -C ~/.local/bin '*/stack'

before_install:
  - export PATH=/opt/ghc/7.10.2/bin:$PATH

install:
  - stack --no-terminal setup

matrix:
  include:
    - env: RESOLVER=lts-8

script:
  - stack --no-terminal test 
  - bash  testit.sh
  - stack --no-terminal exec -- cabal check
  - stack --no-terminal exec -- cabal sdist
# Check that the resulting source distribution can be built & installed.
# If there are no other `.tar.gz` files in `dist`, this can be even simpler:
# `cabal install --force-reinstalls dist/*-*.tar.gz`
 - SRC_TGZ=$(cabal$CABALVER info . | awk '{print $2;exit}').tar.gz &&
   (cd dist && cabal$CABALVER install --force-reinstalls "$SRC_TGZ")

# EOF
